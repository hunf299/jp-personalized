import { getOffset, setOffset } from '../../lib/server/db'; export default async function handler(req,res){ try{ if(req.method==='GET'){ const { type }=req.query||{}; if(!type) return res.status(400).json({error:'type is required'}); const offset=await getOffset(type); return res.json({ type, offset }); } if(req.method==='POST'){ const body=typeof req.body==='string'? JSON.parse(req.body):req.body; const { type, offset }=body||{}; if(!type || typeof offset!=='number') return res.status(400).json({error:'type & offset required'}); await setOffset(type, offset); return res.json({ ok:true }); } return res.status(405).end(); }catch(e){ res.status(500).json({ error:String(e) }); }}